<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Intraday Calculator — Buy / Sell first</title>
  <style>
    :root{--accent:#0066cc; --accent-2:#28a745;}
    body{font-family:system-ui,-apple-system,Roboto,Arial; padding:18px; max-width:980px; margin:auto; background:#f7f8fb; color:#111;}
    h1{text-align:center; margin-bottom:6px;}
    .card{background:#fff; border-radius:10px; padding:16px; box-shadow:0 6px 18px rgba(18,38,63,0.06); margin-top:14px;}
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap;}
    label{font-weight:600; display:block; margin-bottom:6px;}
    input[type="number"], select{padding:8px 10px; border-radius:8px; border:1px solid #d6dbe8; width:160px;}
    .radioRow{display:flex; gap:12px; align-items:center;}
    .small{font-size:.92rem; color:#555;}
    button{padding:8px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:700;}
    .btn-primary{background:var(--accent); color:#fff;}
    .btn-success{background:var(--accent-2); color:#fff;}
    table{width:100%; border-collapse:collapse; margin-top:10px;}
    th,td{padding:8px 10px; border-bottom:1px solid #eef2f7; text-align:left;}
    th{background:#fbfdff;}
    .right{ text-align:right; }
    @media (max-width:600px){ input[type="number"]{ width:100%; } .row{flex-direction:column; align-items:stretch;} }
  </style>
</head>
<body>
  <h1>Intraday Trading Calculator — Buy / Sell First</h1>

  <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
      <div>
        <label>Action</label>
        <div class="radioRow">
          <label><input type="radio" name="side" value="BUY" checked> Buy</label>
          <label><input type="radio" name="side" value="SELL"> Sell</label>
        </div>
      </div>

      <div>
        <label>Stock Price (Entry ₹)</label>
        <input id="entry" type="number" step="0.01" value="500">
      </div>

      <div>
        <label>Capital (₹)</label>
        <input id="capital" type="number" step="1" value="20000">
      </div>

      <div>
        <label>Leverage (X)</label>
        <input id="leverage" type="number" step="0.1" value="5">
      </div>

      <div>
        <label>Total Risk (₹)</label>
        <input id="risk" type="number" step="1" value="2000">
      </div>

      <div>
        <label>Default Profit (₹)</label>
        <input id="profitDefault" type="number" step="1" value="2000">
      </div>
    </div>

    <div style="margin-top:12px; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
      <button id="calc" class="btn-primary">Calculate</button>
      <button id="copyCSV" class="btn-success">Copy CSV</button>
      <div class="small">Quantity = floor(usable capital / entry). Use Buy for long (price ↑), Sell for short (price ↓).</div>
    </div>

    <div id="summary" class="card" style="margin-top:14px;"></div>

    <div id="singleTargets" class="card" style="margin-top:10px;"></div>

    <div id="tableTargets" class="card" style="margin-top:10px;"></div>
  </div>

<script>
  // Helper format
  function fmt(n, decimals=4){
    if (typeof n !== 'number' || !isFinite(n)) return '—';
    // For small numbers show more decimals
    const opts = {minimumFractionDigits: (Math.abs(n) < 1 ? 4 : Math.min(4,Math.max(0,decimals))), maximumFractionDigits: 4};
    return n.toLocaleString('en-IN', opts);
  }

  function calcAll() {
    const side = document.querySelector('input[name="side"]:checked').value; // BUY or SELL
    const entry = parseFloat(document.getElementById('entry').value) || 0;
    const capital = parseFloat(document.getElementById('capital').value) || 0;
    const leverage = parseFloat(document.getElementById('leverage').value) || 1;
    const risk = parseFloat(document.getElementById('risk').value) || 0; // total stop-loss amount
    const profitDefault = parseFloat(document.getElementById('profitDefault').value) || 0;

    const usable = capital * leverage;
    const qty = entry > 0 ? Math.floor(usable / entry) : 0;
    const riskPerShare = qty > 0 ? (risk / qty) : 0;

    // Stop-loss price for the total risk (direction matters)
    // BUY: SL = entry - riskPerShare (price falls to SL causes loss)
    // SELL: SL = entry + riskPerShare (price rises to SL causes loss)
    const slPrice = (qty > 0) ? (side === 'BUY' ? (entry - riskPerShare) : (entry + riskPerShare)) : NaN;

    // Target price for the default profit (profitDefault)
    const profitPerShareDefault = qty > 0 ? (profitDefault / qty) : 0;
    const targetDefault = (qty > 0) ? (side === 'BUY' ? (entry + profitPerShareDefault) : (entry - profitPerShareDefault)) : NaN;

    // Prepare summary block
    const summaryEl = document.getElementById('summary');
    summaryEl.innerHTML = `<h3>Summary</h3>
      <table>
        <tr><th>Action</th><td class="right">${side}</td></tr>
        <tr><th>Entry Price (₹)</th><td class="right">${fmt(entry,2)}</td></tr>
        <tr><th>Usable Capital (₹)</th><td class="right">${fmt(usable,2)}</td></tr>
        <tr><th>Quantity (shares)</th><td class="right">${qty}</td></tr>
        <tr><th>Total Risk (₹)</th><td class="right">${fmt(risk,2)}</td></tr>
        <tr><th>Risk per share (₹)</th><td class="right">${qty>0?fmt(riskPerShare,4):'—'}</td></tr>
        <tr><th>Stop-loss price (₹)</th><td class="right">${qty>0?fmt(slPrice,4):'—'}</td></tr>
        <tr><th>Profit target (₹)</th><td class="right">${fmt(profitDefault,2)}</td></tr>
        <tr><th>Profit per share (₹)</th><td class="right">${qty>0?fmt(profitPerShareDefault,4):'—'}</td></tr>
        <tr><th>Target price for profitDefault (₹)</th><td class="right">${qty>0?fmt(targetDefault,4):'—'}</td></tr>
      </table>`;

    // Single-level targets block: show 2000 risk and 2000 profit specifically (as user asked)
    const singleEl = document.getElementById('singleTargets');
    singleEl.innerHTML = `<h3>Key Levels — Risk ₹${risk.toLocaleString('en-IN')} & Profit ₹${profitDefault.toLocaleString('en-IN')}</h3>
      <table>
        <tr><th>Quantity</th><td class="right">${qty}</td></tr>
        <tr><th>Stop-loss (${risk.toLocaleString('en-IN')})</th><td class="right">${qty>0?fmt(slPrice,4):'—'}</td></tr>
        <tr><th>Target for Profit ₹${profitDefault.toLocaleString('en-IN')}</th><td class="right">${qty>0?fmt(targetDefault,4):'—'}</td></tr>
      </table>
      <div class="small">Note: For <strong>BUY</strong> targets increase from entry. For <strong>SELL</strong> targets decrease from entry.</div>`;

    // Build table of profit targets from 500 to 10,000 (step 500)
    const tableEl = document.getElementById('tableTargets');
    const profits = [];
    for (let p = 500; p <= 10000; p += 500) profits.push(p);

    let rows = `<h3>Targets Table (₹500 → ₹10,000)</h3>
      <table><thead><tr>
        <th>Profit Target (₹)</th>
        <th>Profit / share (₹)</th>
        <th>Target Price (₹)</th>
        <th>Direction</th>
        <th class="right">Qty</th>
      </tr></thead><tbody>`;

    for (const p of profits) {
      const pps = qty > 0 ? (p / qty) : 0;
      const target = qty > 0 ? (side === 'BUY' ? (entry + pps) : (entry - pps)) : NaN;
      const dir = (side === 'BUY') ? 'Appreciation (↑)' : 'Depreciation (↓)';
      rows += `<tr>
        <td>${p.toLocaleString('en-IN')}</td>
        <td class="right">${qty>0?fmt(pps,4):'—'}</td>
        <td class="right">${qty>0?fmt(target,4):'—'}</td>
        <td>${dir}</td>
        <td class="right">${qty}</td>
      </tr>`;
    }

    rows += `</tbody></table>`;
    tableEl.innerHTML = rows;

    // store CSV for copy
    window._lastCSV = (() => {
      const header = ['Profit Target (₹)','Profit per share (₹)','Target Price (₹)','Direction','Qty','Entry','Side','Risk(₹)','SL Price(₹)'];
      const lines = [header.join(',')];
      for (const p of profits) {
        const pps = qty>0 ? (p / qty) : 0;
        const target = qty>0 ? (side === 'BUY' ? (entry + pps) : (entry - pps)) : '';
        const dir = side === 'BUY' ? 'Appreciation' : 'Depreciation';
        lines.push([p, qty>0?pps.toFixed(4):'', qty>0?target.toFixed(4):'', dir, qty, entry, side, risk, qty>0?slPrice.toFixed(4):''].join(','));
      }
      return lines.join('\n');
    })();
  } // calcAll

  // Wire buttons
  document.getElementById('calc').addEventListener('click', calcAll);
  document.getElementById('copyCSV').addEventListener('click', () => {
    if (!window._lastCSV) { alert('Calculate first'); return; }
    navigator.clipboard.writeText(window._lastCSV).then(()=> alert('Targets copied as CSV to clipboard!'));
  });

  // Auto-calc on load
  calcAll();

  // Optional: re-calc when radio or entry changes for convenience
  document.querySelectorAll('input[name="side"]').forEach(el => el.addEventListener('change', calcAll));
  ['entry','capital','leverage','risk','profitDefault'].forEach(id => document.getElementById(id).addEventListener('input', calcAll));
</script>
</body>
</html>
